---
title: Serverless Azure SignalR with C# and Azure Functions
categories:
  - .NET Core
thumbnailImage: data:image/png;base64,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
thumbnailImagePosition: left
coverImage: https://i.ytimg.com/vi/Dvv2hkXyHcg/maxresdefault.jpg
coverMeta: out
tags: [.NET Core, dotnet, SignalR, Serverless, Azure Functions, C#, VScode]
date: 2019/09/10
updated: 2019/09/10
---

第一次接觸使用 Azure SignalR，順便玩玩看雲端託管的服務，那我們就來開始吧～

<!--more-->

因為我習慣用 `Vscode` 開發，所以下面說明都是以 `Vscode` 為主。

## 安裝環境

* 安裝 [Azure Functions Core Tools (v2)](https://github.com/Azure/azure-functions-core-tools#installing)

* 安裝 [.NET Core SDK](https://dotnet.microsoft.com/download)

查看 Azure Functions Core Tools 版本

```
func --Version
```

查看 dotnet core 版本

```
dotnet --Version
```

## 登入 Azure 建立 Azuer SignalR

* [Azure 入口網站](https://portal.azure.com/)

新增 SignalR service 如下圖設定。

![SignalR 設定](https://docs.microsoft.com/zh-tw/azure/azure-signalr/media/signalr-quickstart-azure-functions-javascript/signalr-quickstart-create.png "SignalR 設定")

> 注意：這篇介紹的是無伺服器的方式，所以 Service Mode 要選擇 Serverless。一個 Azure SignalR 只能選擇一個 Service Mode，所以傳統的 Classic 方式和 Serverless 只能擇一，兩者不能共用同一個 Service。

## 設定 Azure Function

1) 開啟建立好的服務，複製主要連接字串。

![複製主要連接字串](https://lh3.googleusercontent.com/ebUg5MNe8j6YLI5O56lihd2NTFy9SHkFwW0WZdZnz25HzlKWkEpveUnMpfw9Og1Mkm2wPnqATYzpizjHtt6onCppsz7kRYnrXE-DRBapeoxUwNJLvjKR7O8nkZzNVu37tdUtRXIqFCluv42EXrrKaCQbWRKEfsSFsotts0AnmxXqpyEjB7gKkDUngv-Si0OX8UAy4nH2t5oc1uJumiSBkucK4djsxN_QQVLuBjXlFlzN1-lNt6x3j-KlraBvkCf7J9wLB7cp1_lOMldLoK6bG5ixiKebGTJly_gfZ9J4HN2JF0OCPP87eI4QsGlVPprfTGwgw6swCJaO4TiodAj0zzgPq8SX6qmCE7fS7-1gSDLK1hzTNedZ5EzcCTblltvhdsOuxgSJFc464UYaYcTfcwzZ3377cg9jzGa4ijNRdFRGHYQbvdssgoMuxA8_gRV3qmtsssBOQzKhRwFriUOcR2Mk2RnJEzCknPvIhDDq_aDuO0DJvUr18p4zLV3IK3gdawQtusInwbLdySAFB6VGiKoPK2xP6IJA1RYGUIWx3a7uEqX3KPpI0OjVY5lORd_rtCzv2m69xRSB_ygGXHYVt1_Mr_MsI-vVbpOzZtPob9L3BljtzaWXYBaDaFMeFGVKKhTHR_Gv9i12qfSZCi1j9pffRE8uAVRTmJVYozGlhqffUtNkUHxaDsO2=w1035-h483-no "複製主要連接字串")

2) 複製官網 [sample](https://github.com/Azure-Samples/signalr-service-quickstart-serverless-chat)

3) 進入 `src/chat/csharp`。 將 `local.settings.sample.json` 重新命名為 `local.settings.json`。 將連接字串貼到 `AzureSignalRConnectionString` 並設定如下。

```json
{
  "IsEncrypted": false,
  "Values": {
    "FUNCTIONS_WORKER_RUNTIME": "dotnet",
    "AzureSignalRConnectionString": "Your connection string here"
  },
  "Host": {
    "LocalHttpPort": 7071,
    "CORS": "http://127.0.0.1:8080,http://localhost:8080,https://azure-samples.github.io",
    "CORSCredentials": true
  }
}
```

> 注意：Host 的部分是在 local 測試時，為了避免 CORS 的限制所設定。請務必將 local 要測試的網域加到 CORS 的值裡面。

4) 開啟 Functions.cs。 官方解釋如下：此函數應用程式中有兩個 HTTP 觸發的函式

* GetSignalRInfo - 使用 SignalRConnectionInfo 輸入繫結來產生並傳回有效的連線資訊。

* SendMessage - 在要求主體中接收聊天訊息，並使用 SignalR 輸出繫結來將訊息廣播給所有已連線的用戶端應用程式。

5) 啟動 local function 測試。

```
func start
```

![local function 啟動](https://lh3.googleusercontent.com/3504Bocz7haQ3JPmdJwqa2XwHdc_EhIQpmtPqtOftqxaQUK5qLHeVAaSz9JNWpEhD7ezP81kEeq6LB6Loa2aL5OIYYWVjjA4GwibWVIl_pbw_BAN9IyZfTBBvmE9Vz-NRljNw1h-6deKZJZLgWT57tKi5I1ml_PwuOFGL0fh1PHbrPq6VC8YyVchEb4l0OdFYdpFz2h14pJMmelh0jV8M7lqQrIY4aK-lN0ttAn01wQZWh7nnXO-aVhFxYVdI6_-SKoDsu2LnFscOqb5QohvLZkFF3FzgPzRqraWwE4F-KRgXrfk1JPrh0r1qB0yAtu0VZfdbwk1PSXlhnabxHVn6_F0Z6pfrcaASFIkQHzrIonsxwPQm40_W5_BJvRxWCxVHQJed5--C4226IoeDXHRu3jevGzWButrAGJq0s9bCDzrmDg_u9MNKP4klPgZDmmLVfOrqZXAIOhrXmiEOvUSPdUXnIyOOzo0mtU7sFyqmf3UnCk7afZQ3uR8gxGhTSEBsVSl743Csc2-Xp84PJ4xWsmwxfi5vxrPRv3NVO5LQ6v5GB_vx49YCqaxJjYv5tZ9Fd_Hq_2S4MhASR5fSGzD_TzReNfs7p0KM333949JNKUb-e2-nLCkwxdHS0Yk-AZKQ70M-bZTUVu3HElg9UrkfqpdMyu4LtzbiimLqIOGyekCOD3FqShQ8r9q=w2206-h1378-no "local function 啟動")

## Local Web 測試

1) 因為瀏覽器若打開 html 頁面會預設使用 https 處理。所以為了避免 CORS 限制。請安裝啟動本機的 http 伺服器。 [Live Server](https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer)

![Live Server](https://lh3.googleusercontent.com/91mzygWcGmu3ljW09OLhtTAfv2Ugb589jczgciy3mOSuWbCUBjOAeN2BUA-MgYWzRbaoXFWwIqoUHqzcykEA4Aw4odpSHDSboaTWxYYpnTT8CmclxtK9t2HYZWUF4HlUKk806h8Jhq3iup2I414hAKpWCtcKgPidv64aPwucq3GYS_ZKsTXudLB7MIfK0wZ_yR47MscN_9ne6KDJvzv3EU4T-1XNMJZdu6ISqzgrUUCgIh-hnUHeSUH6Vy0M1Kc4rNDjBnp14xLA899OhmeZJiB5xQ5UKbv9Icf-dT3yW7qQRSgxWnMvMWgyle_DdmFSYwLJTqMjLaCnBF_LZiS1bJMfDcuctigjp3lqhy75LDcVssUs55sG_8qmd6zgY1A1PVeEbc3faMfQwM9ANDRZA4GAPLFTVYfsp5wVR6cCkYc6tehN7Q1D2DhTrgoJCZ55r0-9nsG-uA11nh5Lmy9Fe7TmPMceVqZXWYYqdP8Q35UHa8Kgq54dfYLjJ2PLOisuHzurd-qQes4NQfhCvsnsXW78VL-UsaW29tFMS_7k7_NH4X9DFNP7oUBsv87ISO_kpm0VWAylbsilxbLT8n5xa57q3USTJuBR5e6DYixRM0L0K_ElogvfiC2TMmYg_F4M5j_Fmg-VoPrxzIt4u6CQ9sNJ6ExcujX0ZEth-aiguKyQNlK2xBs2x9L8=w1908-h938-no "Live Server")

2) 用 `Live Server` 開啟 sample html 範本 `/docs/demo/chat-v2/index.html`。

![開啟 sample html 範本](https://lh3.googleusercontent.com/AgiqJicbCJPOqOd7krSCj4eoQulKtewUr71Gs67h-Z3PWiWpQT3hUguVvqQ_Wbsg82SPMZ6Cq5BC9BLN-YkgZQTf1l7JRwd3k5l0yfztgG3Mb_rRUps_ozF1ebzft2z4rst0i4xcEdY453CtVWWHIfkpl6iGgAdDptdUUDfeWvytYg8LEZX-Z9mpkyXI79oI3sYcXVgloKf0FH3ArfwUquBNNwQEUano4e7PPOcYkvXP3d0v9eO2JvayxYfc-c3WSSHEj4rPbx6SvlbZa8O4-0Q_x-rDQuLEoa7u7kCrBnIdaw0xbRxRBhPiGGxbYUJ_s3dBstI4DKzDt-wyJyKBwwV8K5zhfy5wwx4E4grg9NVZf9dp0l2-DDoh7zjHBLCpgLU1-YdmLKp47cmwxLPA7-FnloIsldbLrBS7hv3OQAfDMEb9o8_MQb_44ELsklUVY6wSo6rY894Ew5Wmu24CBd5UbjnO_vjOvvtKNPZKrnDmvnqmofS0x1Kk-Qzy5qKgZ4M3xXt8NAwGm6qa2Xi2vTZhKwy-ApKzBz-VqaOE1VWNW4cCgUZCh00MBeYxWSCdeJOrQlHgkW_tP0zuBBZFxu88siuX6ZTxq3mpVNa7bENEjPJjCSpxMXQemG-CqhQCnGZJTBkSUArTNUSNRDaQ4jixziHJURlhdZlS04s0MGEjPgsLJGM_RKkR=w2206-h1378-no "開啟 sample html 範本")

3) 自動開啟後，務必輸入 `apiBaseUrl` local 測試為 `http://localhost:7071`， Name 也是必填，請輸入聊天室的使用者名稱即可。

4) 成功之後就可以輸入訊息測試。並能多開數個分頁，測試訊息的接收是否正常。

![測試訊息接收](https://lh3.googleusercontent.com/PYziZWr5t2kOAe9sp4dAJ7f9RmUy-MVlPhZqyus33kJyLQIj61CocH4Rdj955TFA1SVQXZlsSqDhZtafBG5Z25vcLlq28mHCp8OnbxOqh65P81rNFxOH56SfUkJ91ha4KPI8ZHzzSk9zArbDgBNE9iM9NjTZ97lsDsbyO9kuqLDpuj2emQ1r9ak9iRLQXAotahmAelkr2dUiLCsbCphjQHX_fZA9k9KAsAmt2Rq7s5eBTqoHr_V3ZPHemP8QHJg41cHBMfLMwxaKKxqh7PtubOq33yRamyEsrFBfEi8mWAPfLTYmJbGD0izpZEuG1fhBamxoRt175Tgjv6qEIrwakqNQyBn_LnRoQCXYsntJ0XaWDka9yM1Vk9g4zeXp9Jdus09p3Gyj_ACYL98ESUffg8ifDiOPy7cAeFje9dM_FG3bQMtNBLn6Rq8BXXOcERuYUunQsOyalskX_8rnrfvDFGNm9I7Lm5y-wUMw59DmiuvvZsftTtM8lzhLKJDPziD1a_r13RhjLlBo1vfXM0Iq8dsGGe0G4KbinGq4kLIIx0rjg_BDDRQwQUThCUzpOVkYzkKPr7zyFTilAaZAsOeF_k54MrnLVq0sBPCUNN2EYUxI-mzWuhEtNIOzY4K-tmP1AtljaQeVRYnuDp-mMbmLfPW-2PiSf7iSlu6B03DhIpS3EfbFHW0xKEUH=w2532-h1246-no "測試訊息接收")

## 發布 Azure Function

* 安裝 [Azure Functions](vscode:extension/ms-azuretools.vscode-azurefunctions) 擴充功能。

![Azure Functions](https://docs.microsoft.com/zh-tw/azure/includes/media/functions-install-vs-code-extension/vscode-install-extension.png "Azure Functions")

安裝完後請務必重開 VScode。接下來我們開始發布 Azure Function。

1) 請務必確定 VScode 只開啟 src/chat/csharp 中的 csharp 資料夾。

![csharp 資料夾](https://lh3.googleusercontent.com/F2CzlCEtvEpCrmw7V_8x9zWfv-OYRpzWj18QN-HL_WfF6s3XCH8u8FW8QStEVeNvXCI6PDmPNKPdLolL8Vlh5EvtSYJvuYRpCADBrALiZIy510xQPTNSl4vZAiwWfFu7IXTGn9sIINa8YVH_ya_KRfkSX3-_5EvsFNJOwyQna6Itv0IaqDKpR2-TEOADt1-FN73D1WyTINzPcd3xS2IYk5EKJrloZPO1Jbj3ZlXxpvahgExMM5uxUZOR4X49neuWpuyIjxVzjdAKvY4ADg2W5cdBvQG-b02xAer7yQ6k4gB15eI3_d98HWArt-FDrMwt5EP9foIFU-dBT5V4B-C2-woI0MejtaK07QNZ082ahzsqV7odBCUVH2u3laLEVGzFRhAddf1DhpDobOQhk4-IB3XG7kYiRiWXr4lco1JTCYTDhy-TxgyHSpUsyMxtb8f--kjdQ5y1IF_uGQDRhF7dFhEUKImOFRj1Kc7sypo4uMS07dQAvFm0Nt7G5xX-IE8QOKjmgNrvOypegpsFswjQ_RDyd0YuT21ioMs4oogu8qEdanhGBc_9-lmbxa3Pfe_P2RauuKrczEJ2zIZlahNBP_e3CsPQqy1B5FwtWWk7Aej0GkqHLwJ7HmTi4oC6cH0fXQzz2ATYuSKg0VsPPeh5PGAbLsQZDZIipl1ScojTL07PltVv9ZDBYVwn=w916-h898-no "csharp 資料夾")

2) 從擴充功能登入 Azure 帳號。

![登入 Azure 帳號](https://lh3.googleusercontent.com/3ycoKSgCD3L5bhujgJ_qsAaR7iEmu-cDzoi3GceJ4nRtwqz9Sh9ZCNXXQ8nvcuWIUgm4mezj76JL3t3dy1lSdIi-74oqXPTDQYxol0-kaSbF5YTSgsdGI2wgSe_TN4g3UToGBBZdBHrGl9Xw784YIbzI2oFFgQ5FGaH2v3-1JkYpHJB1tde5NdND30pRpnwrbFzotRiyxOyt6lBDlWxuBbSpfIDISQa8Ya-sO79Z8r8cl2RMywRmX3WLVBI3OKVl9Gvi5OJuWmoRyb6jIfeBAWM8i89h5rwdEpCVkXvZO1BlxXRnIrp3Bo4u_EMLkC3VZb9G2KNlVkXgVel-6dL9IqoJ8oVPvorFZMV_sgZwW2_C_D6TH_1SsOs3OVlVT8lwoRjY4RGDJbaQzi7QtfZXfGk5--aTvDw7AV25IP0grR_qAt9X2_SmU4tjEWcjTYN6wG6a6FrQsRhbLhhGC1QOdD1NhyMC-tXZhz9XXuwKyC58CHc_ebYMGogv1PUuqhEy0wMrtKKtC0ZxhGZmH52BcjBrp0fIkp5JJIOeaiZelgAQLJ5-PpAvyY4OpDmSUnJle6hKAHFh6UmCFAu3v1bK4nS0zILSiPobyLEnwrkMbHAJzr44wOMTSVQlsa0ogK5GqER5NNRCACJ-61ztnUEEvdLGN3AhkWmQiCk2ya0YEECjl0LeXGuHk72f=w463-h431-no "登入 Azure 帳號")

3) 選擇要發布的地方上傳。

![上傳 Azure Functions](https://lh3.googleusercontent.com/g-Un1PRQE8Npznb4Hhi9gK6Doc7h4nunpZA3zKMEypcb5j5Ks54x20lEc2UeRykR532VeixY7u11THtW9HeALTz47SUBzzvE6vYzKZxg56VCa8GugLdxRDxvkDu0x6rZvvilshkKnPhsaNCsWEM2IkWSR3Nj1ctjhoGhn0gjjCTPz63muznRew9qqt87p-4ozb8EVNuHwIkJpCvG99uRGQ5L7cdaL6rS-CMmnJUB4EjyM15NeVCKJRpeiYJHkRnvuO_OhqLRhAVYRNtiFywIfnSviMhR1TU9XHYkq-IzS2V8cJ0FRw5u1FE9sF1BE3tjFNiuGiogDdVZ5X4JaGenHgYQU6TrACnF0I6xkHdC9oKXzXvaDgrQGos5UjNytVJeikB6DhCo0afU5vz1Qjtdn8sNRWqEAJvFAfYzVjDNtLgESZQ-ADAE099ID81UPDTnzbVYjZA8zCBkBZUNwQQOplIK-Xft_6cCFQtcsZx-ReUUJnma0MuhTd866gyM4_07eadyJ3ahZAQCZG73AvpUzxRIUsRpgjJ_-lGeEumg_CMxbF0QdEbvZfxriX7azPOitHPKC8YuXhcMAAmmD_3IEpp_VAVyadbRHWBzPtRvS8pkuMN2mFDlY1Kkabuwo5gvHF1FE9PyNodyni6pMPIJ4d2OOT8UO_5e_26Pjxsp5FOnO1nKbV5UPRqy=w916-h402-no "上傳 Azure Functions")

## 測試連線上 Azure Functions

1) 拷貝 Azure Function url，將 html 中 `apiBaseUrl` 改為線上的 url。

![Copy Azure Function url](https://lh3.googleusercontent.com/H_G9dyo8H_V-04HnuKLeYz_RIzpELVQEeIU2Oss1BgV4kb0ih2rs2ihnSG5V4cBpF27Bhuax9uA3jrh5jzi4NXG3xJR8g16s8Nksmlp7Q5zbI6JBkepAhstRwqkBhFiTtt2jAwGlTnWy1TXkPOqzjD8ejAxMDZYuR1Tsrrw9lHCxdicNe233wUwB_9T9Rj7CGP3SM3VvpYsBQ2EBQhrFYyCrEd7bHkMNT7lkuT1CIGT0eniiMKF5r8lmI3JWDKejkDnDj-Xhk5FJ8GhKIpbUTqfbGoYpmRCvhXkXGlPv_225nceq7FJjLbP47e7d0Xyiw4DSfpY4-eLzFQ9Pk1A36sw6u-3kko-FOEWx9hgm2wFkgUn8W-VG60dkn-edy6xzzVBG60BpNBtFU566ckPtVMv0BVtr6rcyTSghwv2BY3iJ5NNQNYl2n9wzDxGAhvp8USAVfkkooBvzISbwUHFE5mdAujs-xyUaQ7JGGwZEP2gpj5UrhW1mj2FKEtuywYk_HW02qkLII8igNcPqbHSy2xKB-hjsaERItaiDeBZvhujagZOWVhYDqdA6MvgfHm9IC8Dx2T2TtZSb6HsTNABrbi3tcRLbiG93_egs5jCaeLvkgA0yxATUZNXirp1z83sRtolFWzJOKeurzUtbT8qSlTkelW7UmZGEblCO6egJM9Oz7e-L4QE8mosh=w988-h371-no "Copy Azure Function url")

![修改 apiBaseUrl](https://lh3.googleusercontent.com/6knLBtYnBsO_4Q_JDPw8eeF1ndcFzBRIKrQPXxJY1XU-e_Dtcsf950sXVO5EDI6CsFwAcMyQ_C_noV8rIb-tWuQZaSVgYTV9-PAn8BHzHShn_8oP_nF3-ix7-6bTR_Zd8ABaSYk1mo3LN6bED7uxK0U9mTY36PF53UpWKF018lOsSezcpuouyeM_qF8TPOsuZ4T4t2V7QBc6NM8z5qXVC3uDLPUrQFQwfegIKE_8k5kPgHMxNTPOoVChCf1k4_YEIxQDJUvGdWa36rI789G10b0VHjzCQxS4vRROdTKJ3p2nNfhDd1LxTvsuUGUnIRvcK7wozQ5G0j8hsxCv-xQJ29dgQkG8nhM8RrBX4oz4Na5_169tKWRUIbIwsJQ55UugbqxpM3OC36-BmvxZ9s3cz9ROJ4cYCkKVnREJyXo4gGMFck_h0XYxJe94-I0LXQQ3A3uGATHqRgl_CcE-1xISolLp0mYvgKpOC6XuDiZH1tRGt0xSInHwnZYuMc59fBawXeiivDGkIjacRbbUsHKr0RLPQtb6eAW1MUyVpOVMhjTQlcNWUJ_Vbsy6VtprtIeolwbUQQSNgqRSemMaS_zPCH1djV1gG-94h_8wOcm_phJ8AkfKmN1elF_gB8WTMPFvs9etI30qy60U4zba4HU2tlFYE0OnoyGHOlvaHzjBSj4Pm7zHJ8Ben9tG=w2192-h880-no "修改 apiBaseUrl")

2) 因為不同網域去打 API 會有 CORS 的限制，所以需要將測試的網址加到 Azure Function CORS 清單。

![功能設定](https://lh3.googleusercontent.com/QrDuwqSA60bt68i0DoP72Ci94RwvCX6hbD_cjb-yYHhAzBboVJxMZzYIZ6lMgkZAlcv3wyBfBx9sqxwsnUpKwsB9HU8cmQiHCDEnHHLaf5ZsIe5rXI6x8yPAifMnei4xjnRoR5qBkTWoE4jw7gwIE7aDoQeu3VnWTLAndv0-N5nmdY5FoBp1h2ESAM6rvoYYdwxvyWJSJq_xaq43p-koGaoOlEyxfeiUuVGNfPadwjWg9mBAEXFNp2pBa84A4OOd6dfLX1Wzdm1cWgwRtzob9-bF1GZT8f7cj2hl2WMRdhQaP-itxxoFcSVut6uscXFkN1G93Yr7ckHLeiM04jqcMWUdf5IkAtfEInI9lDinK9gljEDCRe8xHCRewByz2Fbp6eSt_RA3RV6FqBi8-VaIuBn0aqlBvPrP7HC4lfFLqy3tdeh7T_afav5Cn2rPn6YuTn4eFGduKK6vvslTShwT208Nl7VE2I9-p9IF0Hndfty1uINjTWP66RRhvpBo40qFSNR95vDw2pGXY-QCEvZinXOk5-YK5RZ6-mmXxc-B5D7mjwbR6u0fiX58NaIL2Wce1hVkraoycTOg2Q1wN25L-OwN2zLmTe9KbwQJ3lqoTsAGuq_tGz-nfHWLpf9cXaqYX3YvEqwN2BwNAs6YKyYCnsR65zG5FlzgSM5UERmDd05BXpI7mnDlhLKF=w996-h574-no "功能設定")

![CORS 清單](https://lh3.googleusercontent.com/Rp_UC6QBZeSOB_6j3kFgK-w9aZNOhE_oybskL2rkFZSdEFYrrfnylveIY0fX-wv3wODLHZyD8AOu2IUwYZebGn5Z7r_rx1jNg61SVDRhuXDYKoLpz7WTfCkcrlZqUx2iEyYJifDtSjDE8GtWehIa8QhwbX1Bvd5qV2vg3Ib5opXrbirNkPy_u-LACXcIrb2ppbRJgs18C9KQs-PY1EPOq3L0s82tpCNkDgGm7vXPVzxcof5zYRpF9VEWumxKadf5a080ALj2oqP6zmZsKJNQdLNzVr2xX8GU-n37TijB4G2masD6i1M6LcSxupOoO038I4nlYutuCUfAy4zp4VKB5xX6oFpX1cXePexfH0Lcdak1yjxSO9r53B_ZrbDC3GhG98V9YehQ7ONMzcy0-vEGyijB-D5mzP6FMgDt6qQHOBwgjOt2p7DOOfHv3em8Z08YVcjb0PJD1hLCI6L28CynDIhZKmtVFAYFJnJytd8938x7xdRJ1p4Y0QMZSBDlXj6nj7uEbRcC082NGv9Q4HCjARts7YVkriMl6mmpGcXg9SsBJhfZOLaPl9_eUP2hAu2dntZpSxg9gOVpoEK3yohgeaXLKAOgqH55KDiAikDyw5e_Waqbvz3LqbfT3wR-z5SkYjhaK9nz0pZ4p59cnOkWqu_81nqpMHdGn0quQokoh-nO7WNgfZyL-7RZ=w561-h592-no "CORS 清單")

3) 一樣使用 `Live Server` 開啟範本，就會成功連上囉~

## 把 web 放到線上 server 測試

> 注意：剛剛上面都是使用 local web 測試。若要把 web 放在線上測試的話，需要在 Azure Function 設定連線變數。官網沒寫這段，害我鬼打牆了好一陣子呀～怎麼設定變數如下圖。

![Configuration](https://lh3.googleusercontent.com/_aALFr19DSl7A3vekHZWLNC-DKSZhWp44BLPoujaLFiCL6MDn8sxVNKZvw3IKB9-OmwOoxCHSa-ltJurLIG83osiLAaZeTjJxj8AlFnJBt3uGR2tyegFXkdoyxKpa1gDW3dZdPICSsCPiN4KMTlYAzSBdNEQoI3RnOvtkoNqruCcVph5qICYnAfBkGywtdR-dJjTyKKfuW8RZaFEPcHqqGhg35nibhg1jei8wJflLVHtN48vFNcsrAuyfGnziyEGjj-VxPocDb9ofJEHR8uRnIjL9qUOB-zGb9TA1j7Pyo1tV9UkuczX1KWXCO_jsd3rp-FDCAQ2dcHoLc6y9OagLkJSqGC7EJkaccgCuu1HRmb7_woIrvnIO8k5iYbvsf4bO7af8IBLgA-OFR_YlQpIGsXwoc1PSu-rMCGAEzSkhHsDNmTaCpyO-L-YLB7Z3vCOkavIMRpDV1ZcnLYd8jQ5USusENO0bzOXZNo4-D6sPyGhpl9g92pOoQmJ8DRgaxAqTGRxItUpkNLBDudfi-4-jGM_IDbnRTyLlWW9hLx3FLjDfA2QL0-z2Plp0NRfh9qdegDb3Ym-fmKS71Wp2g0WsVxhNhfdf9pDYcAkBDKqNF9HpIlRuATIi_HAGFGJ0W9imvB0-q2gQ1AfS2_YOIvUTK0v1Kl3-OFJuLwZqbm2kL4d-Sei-CSUkhV_=w451-h285-no "Configuration")

![Add Variable](https://lh3.googleusercontent.com/jeAfFyL52YQfyyvIpqgAMgrqCLGm3yBtZDYfH_VXbFExgRV2kTjgkj5TOad0fZ4EkwPYyKOfKrgajprSXSsqmn4Tdcp_73h5YRS0VBZz55ZoHE6_ojFZ7TmeAOnd7ONKRQFxzr5jRZEZd34eWwVahN9o9bZYgcBWpebxN0fIihVQdrf3a6meMzzLPRH1HVX8hXwXr_W0j3FKVAz2Lf2-cNa1Bni_eycfszIrU7XIf8fiVuldSBReqZgd5NtbSuiRJSPFIuCjg08_X9e2aCeeKYBfjuy9tS7c2V4f0gUk3CoC9W-Beyh3ueJ17TkIm0BhzbUqWt8y374DL7FQKr55GaHzz734aRkvVOQnUNeR6efL1KVcriTVDwNCbjuqovljM7_b7VvQtY9O766_F8R1TNMRz26z6sqN9QfFbEFGEBbmECjJbecN8VKb-gTZ_4qSqnHTyiI-UCzcWPddZkoZ1mRridVcnZexsEQ6TD-k7upFmprShkVX-MuP-QIjR6MPqS0QCiwTbzSLB6rwgXbdylDIh6oUlc-5PrpYBhetsdjEIKqIDQNKOkEngxCuZn50bixXooAT78orR4EatTwcd67ERYGRqJRB4KQOxSfHaJCuq9ut53NvM9lPxsPsO0f_kuFsYL46-sSodOnd2-CE2dtRUK-nrqejDhWL_9EdLwBTrlAM9Dqph-Yt=w989-h560-no "Add Variable")

> 記得如果是線上 web 都要把網域再加到 CORS 清單喔～

以上是無伺服器的雲端 Azure SignalR 基本安裝與設定，如果要玩地端的話可以參考官方[這篇](https://docs.microsoft.com/zh-tw/aspnet/core/tutorials/signalr?view=aspnetcore-2.2&tabs=visual-studio)，那我們下次見～

## 參考資料

* [快速入門：使用 C# 搭配 Azure Functions 與 SignalR 服務來建立聊天室](https://docs.microsoft.com/zh-tw/azure/azure-signalr/signalr-quickstart-azure-functions-csharp)
* [快速入門：使用 JavaScript 搭配 Azure Functions 與 SignalR 服務來建立聊天室](https://docs.microsoft.com/zh-tw/azure/azure-signalr/signalr-quickstart-azure-functions-javascript)
* [使用 Visual Studio Code 開發 Azure Functions](https://docs.microsoft.com/zh-tw/azure/azure-functions/functions-develop-vs-code)
* [教學課程：開始使用 ASP.NET Core SignalR](https://docs.microsoft.com/zh-tw/aspnet/core/tutorials/signalr?view=aspnetcore-2.2&tabs=visual-studio)
* [將訊息傳送至用戶端](https://docs.microsoft.com/zh-tw/aspnet/core/signalr/hubs?view=aspnetcore-2.2#send-messages-to-clients)
* [SignalR Tutorial 16 - Coding Our JavaScript (Client Side) - Part 1](https://youtu.be/MK8n8pg9bLE)